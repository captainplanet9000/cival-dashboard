# GWDS Agent System Documentation

## Overview

The Global Wealth Distribution System (GWDS) Agent System is a comprehensive framework for creating, executing, and managing intelligent trading agents. It combines powerful workflow automation, LLM-powered intelligence, and multi-agent collaboration to enable sophisticated trading operations.

The GWDS Agent System consists of several integrated components:

1. **Agent Workflows** - Core execution engine for agent operations
2. **Workflow Templates** - Pre-configured workflows for common scenarios
3. **Workflow Scheduling** - Automated execution of recurring workflows
4. **Agent Collaboration** - Multi-agent coordinated workflows
5. **LLM Integration** - Natural language processing and reasoning
6. **MCP Tool Integration** - External API access for data and execution

## Agent Types

The system supports several specialized agent types:

- **Analyst Agents** - Perform market analysis and research
- **Trader Agents** - Execute trades and manage portfolios
- **Monitor Agents** - Track performance and assess risk

## Core Features

### Agent Workflows

The workflow system enables agents to execute complex operations:

- **Market Analysis** - Analyze price trends, technical indicators, and sentiment
- **Risk Assessment** - Evaluate portfolio risk, volatility, and exposure
- **Trade Execution** - Place trades with specific parameters and constraints
- **Portfolio Rebalancing** - Adjust asset allocations to match targets

Each workflow is executed through a step-by-step process:

1. Natural language input is processed by the LLM
2. A plan is generated with specific steps
3. Each step is executed, potentially using MCP tools
4. Results are collected and processed
5. A summary is generated by the LLM

### Workflow Templates

Templates provide pre-configured workflows with customizable parameters:

- **Basic Market Analysis** - Quick overview of asset performance
- **Technical Analysis** - Detailed technical indicator analysis
- **Sentiment Analysis** - Social media and news sentiment evaluation
- **Standard Trade Execution** - Basic trade with stop loss and take profit
- **Portfolio Rebalance** - Adjust portfolio to target allocations

Templates include:
- Description of purpose and usage
- Required and optional parameters
- Parameter validation
- Natural language prompt generation

### Workflow Scheduling

The scheduling system enables automation of recurring workflows:

- **Flexible Scheduling** - One-time, hourly, daily, weekly, monthly
- **Custom Scheduling** - Advanced scheduling with cron expressions
- **Execution History** - Track all scheduled executions
- **Status Monitoring** - Real-time status of scheduled workflows
- **Error Handling** - Notification and recovery options

### Agent Collaboration

The collaboration system enables coordination between multiple agents:

- **Predefined Flows** - Structured multi-agent workflows
- **Role Assignment** - Define specific roles for each agent
- **Approval Workflows** - Critical steps require approval
- **Status Tracking** - Monitor progress in real-time
- **Result Summarization** - Generate comprehensive reports

#### Collaboration Flows

1. **Market Analysis and Trade**:
   - Analyst performs market analysis
   - Trader reviews and executes trades
   - Monitor observes and records results

2. **Risk Assessment and Rebalance**:
   - Monitor evaluates portfolio risk
   - Analyst reviews assessment
   - Trader rebalances portfolio

3. **Multi-Asset Analysis**:
   - Multiple analysts analyze different assets
   - Compile comprehensive market report
   - Trader determines actionable insights

## Architecture

### Services

- **AgentWorkflowService** - Core workflow execution engine
- **LlmService** - Natural language processing with LLMs
- **McpToolsService** - External tool integration
- **WorkflowTemplateService** - Template management
- **WorkflowSchedulerService** - Scheduling and automation
- **AgentCollaborationService** - Multi-agent coordination

### API Endpoints

- **/api/agents/:agentId/workflows** - Manage agent workflows
- **/api/templates** - Access workflow templates
- **/api/schedules** - Manage scheduled workflows
- **/api/collaborations** - Coordinate multi-agent tasks

### UI Components

- **AgentWorkflow** - Create and execute workflows
- **WorkflowTemplates** - Select and customize templates
- **WorkflowScheduler** - Schedule recurring workflows
- **AgentCollaboration** - Manage multi-agent collaborations

## LLM Integration

The system leverages Large Language Models for:

- **Workflow Planning** - Convert natural language to executable steps
- **Parameter Extraction** - Identify required parameters from instructions
- **Result Analysis** - Interpret and explain execution results
- **Summary Generation** - Create clear summaries of complex operations
- **Decision Making** - Provide reasoning for recommendations

## MCP Tool Integration

Model Context Protocol tools provide access to:

- **Exchange Data** - Real-time market data from exchanges
- **Price Analysis** - Technical analysis indicators and patterns
- **Market Sentiment** - Social media and news sentiment analysis
- **Trade Execution** - Place trades on supported exchanges
- **DeFi Integration** - Interact with decentralized finance protocols

## Security and Permissions

The system includes robust security features:

- **Agent Permissions** - Control what each agent can access and execute
- **Trading Limits** - Enforce maximum trading amounts and frequencies
- **Approval Workflows** - Critical operations require explicit approval
- **Execution Logging** - Comprehensive audit trail of all operations
- **Role-Based Access** - Control access based on agent roles

## Usage Examples

### Creating a Market Analysis Workflow

```typescript
// Using a template
const result = await workflowService.executeWorkflow(
  agent.id,
  'MARKET_ANALYSIS',
  'Analyze BTC price trends over the past week and identify key support/resistance levels'
);

// Steps executed:
// 1. Fetch BTC price data
// 2. Calculate technical indicators
// 3. Analyze price patterns
// 4. Identify support/resistance
// 5. Generate summary report
```

### Scheduling a Portfolio Rebalance

```typescript
const schedule = await schedulerService.createSchedule({
  name: 'Weekly Portfolio Rebalance',
  agentId: tradingAgent.id,
  workflowId: 'portfolio-rebalance-workflow',
  workflowType: 'PORTFOLIO_REBALANCE',
  input: 'Rebalance portfolio to: BTC 40%, ETH 30%, SOL 20%, USDC 10%',
  frequency: 'WEEKLY',
  startDate: new Date()
});
```

### Creating a Multi-Agent Collaboration

```typescript
const task = await collaborationService.createCollaborationTask(
  farmId,
  'market_analysis_and_trade',
  analystAgent.id,
  {
    name: 'BTC Market Analysis and Trade',
    agentAssignments: {
      [analystAgent.id]: 'INITIATOR',
      [traderAgent.id]: 'EXECUTOR',
      [monitorAgent.id]: 'OBSERVER'
    },
    metadata: {
      assets: 'BTC',
      tradingAmount: '1000'
    }
  }
);
```

## Technical Implementation

### Agent Workflow Service

```typescript
// Core workflow execution method
public async executeWorkflow(
  agentId: string | number,
  workflowType: WorkflowType,
  input: string
): Promise<WorkflowExecutionResult> {
  // 1. Generate workflow steps using LLM
  const planResponse = await llmService.generateWorkflowPlan(workflowType, input);
  
  // 2. Execute each step
  for (const step of planResponse.steps) {
    // Execute step, potentially using MCP tools
    const stepResult = await this.executeWorkflowStep(step);
    // Store step result
  }
  
  // 3. Generate summary
  const summary = await llmService.generateWorkflowSummary(workflowType, input, results);
  
  return { success: true, steps: executedSteps, finalResult: summary };
}
```

### LLM Service Integration

```typescript
// Generate a workflow plan from natural language input
public async generateWorkflowPlan(
  workflowType: WorkflowType,
  input: string
): Promise<LlmPlanResponse> {
  // Construct prompt for the LLM
  const prompt = `
    You are an intelligent trading agent performing a ${workflowType} workflow.
    Given the user's instructions: "${input}"
    Generate a detailed step-by-step plan to accomplish this task.
    For each step, specify:
    1. A description of the step
    2. Which tool to use (if any)
    3. The parameters for the tool
  `;
  
  // Call LLM via MCP
  const llmResponse = await mcpService.callLlm({
    prompt,
    temperature: 0.2,
    max_tokens: 500
  });
  
  // Parse and structure the response
  return parseLlmPlanResponse(llmResponse);
}
```

### MCP Tool Integration

```typescript
// Execute an MCP tool
public async executeToolCall(
  toolId: McpToolId,
  params: Record<string, any>
): Promise<McpToolResult> {
  try {
    // Validate permissions for this tool
    this.validateToolPermissions(toolId, params);
    
    // Call the appropriate MCP tool
    const result = await mcpService.callTool(toolId, params);
    
    return { success: true, data: result };
  } catch (error) {
    return { success: false, error: error.message };
  }
}
```

### Collaboration System

```typescript
// Execute a collaboration step
public async executeCollaborationStep(
  taskId: string,
  agentId: string | number,
  input: string
): Promise<{
  success: boolean;
  result?: any;
  nextStep?: number;
  error?: string;
}> {
  // 1. Find the current step for this task
  const currentStep = this.findCurrentStep(taskId);
  
  // 2. Verify the agent is assigned to this step
  this.verifyAgentAssignment(taskId, agentId, currentStep);
  
  // 3. Execute the step (may involve a workflow or manual action)
  const result = await this.executeStep(taskId, currentStep, input);
  
  // 4. Update step status and determine next step
  return this.updateStepAndProgress(taskId, currentStep, result);
}
```

## Future Development

The GWDS Agent System is designed for extensibility:

- **Additional Workflow Types** - Expand to cover more trading scenarios
- **Advanced LLM Integration** - Incorporate more sophisticated prompting
- **Enhanced Multi-Agent Collaboration** - Support more complex coordination
- **AI-Driven Agent Evolution** - Self-improving agents based on performance
- **Cross-Exchange Operations** - Unified operations across multiple venues 